# 可靠性支柱
## 可靠性 
可靠性支柱涵盖相关工作负载按照计划正确而稳定执行其预期功能的能力。它包括在其全部生命 周期内运行与测试工作负载的能力。
设计原则  在云中，有许多原则可帮助您提高可靠性。在讨论最佳实践时，请记住以下几点:  
* 自动从故障中恢复

通过监控工作负载的关键性能指标 (KPI)，您可以在指标超过阈值时 触发自动化响应机制。这些 KPI 应该是对业务价值（而不是服务运营的技术方面）的一种 度量。这包括自动发送故障通知和跟踪故障以及启动解决或修复故障的自动恢复流程。 借助更高级的自动化功能，您可以在故障发生之前预测和修复故障.  
* 测试恢复过程：

在本地环境中，经常会通过执行测试来证明工作负载能够在特定场景中正 常运作。通常不会利用测试来验证恢复策略。在云中，您可以测试工作负载的故障情况， 并验证您的恢复程序。您可以采用自动化方式来模拟不同的故障，也可以重新建立之前导 致故障的场景。此方式可以在实际的故障发生 以前 揭示您可以测试与修复的故障路径， 从而降低风险.  横向扩展以提高聚合工作负载的可用性：使用多个小型资源取代一个大型资源，以降低 单个故障对整个工作负载的影响。跨多个较小的资源分配请求，以确保它们不共用常见故障点。 
* 无需预估容量：

本地工作负载出现故障的常见原因是资源饱和，即对工作负载的需求超 过该工作负载的容量（这通常是拒绝服务攻击的目标）。在云中，您可以监控需求和工 作负载利用率，并自动添加或删除资源，以保持最佳水平来满足需求，而不会出现超额 预置或预置不足的问题。
* 自动管理变更：

使用自动化方式对基础设施进行变更。需要被管理的变更包括，对自动化 的变更，可对其进行跟踪与审查。
* 指导原则

要实现可靠性，必须从基础入手，而基础是服务配额和网络拓扑适应工作负载的环境。在设 计时，分布式系统的工作负载架构必须能够预防与减少故障。工作负载必须处理需求或要求的变化，而且它的设计必须能够检测故障，并自动加以修复。
* 弹性，以及可靠性的组件

云中的工作负载的可靠性取决于多个因素，其中最主要的要属弹性,弹性是工作负载从基础设施或服务中断中恢复、动态获取计算资源以满足需求以及减少诸 如配置错误或暂时性网络问题等中断的能力。  
* 可用性 

可用性 （也被称作 服务可用性 ）是对弹性进行定量测量的常用指标。 可用性是工作负载可供使用的时间百分比。 可供使用 指的是它会在有需要时履行其约定的功能。这里计算的是一段时间内的百分比，例如一个月、一年或之后的三年。最严格地来说，当应用程 序不能正常运行（包括计划的和计划外的中断）时，可用性就会降低,

可用率 = 可供使用时间/总时间  

* 一段时间内（通常为一年）正常运行时间的百分比（例如 99.9%）
* 在第一项中的公式中，有些客户选择在总时间中排除计划的维护停机时间（例如，计划的维护）。但是，这通常是错误的选择，因为在此期间，您的用户实际上可能需要使用您的服务。

下表列出了常见的应用程序可用性设计目标，以及在仍然达到目标的同时，一年内可能会出现的中断的最大时长。该表包含我们在每个可用性层常常会看到的应用程序类型示例

|可用性|最大不可用性（每年）|应用程序类别|
|---|---|---|
|99%|3 天 15 小时|批处理、数据提取、传输和负载作业|
|99.9%|8 小时 45 分钟|内部工具，如知识管理、项目跟踪|
|99.95%|4 小时 22 分钟|网上商务、销售点|
|99.99%|52 分钟|视频传输、广播工作负载|
|99.999%|5 分钟|ATM 交易、电信工作负载|

**针对硬依赖关系计算可用性。**
许多系统对其他系统具有硬依赖关系，依赖的系统中的中断会直接转换为调用系统的中断。这与软依赖关系相反，其中依赖的系统的故障会在应用程序中得到弥补。在出现此类硬依赖关系的情况下，调用系统的可用性是依赖的系统可用性的结果。例如， 如果您有一个旨在实现 99.99% 可用性的系统，它对两个其他独立系统具有硬依赖关系，这两个系统都旨在实现 99.99% 的可用性，则工作负载在理论上可以实现 99.97% 的可用性：

𝐴𝑣𝑎𝑖𝑙𝑤𝑜𝑟𝑘𝑙𝑜𝑎𝑑=𝐴𝑣𝑎𝑖𝑙𝑖𝑛𝑣𝑜𝑘×𝐴𝑣𝑎𝑖𝑙𝑑𝑒𝑝1×𝐴𝑣𝑎𝑖𝑙𝑑𝑒𝑝2 99.99%×99.99%×99.99%=99.97%


因此，在计算您自己的可用性时，一定要了解您的依赖项及其可用性设计目标。

**针对冗余组件计算可用性。**
当系统涉及到使用独立的冗余组件（例如，冗余的可用区）时，从理论上讲，可用性的计算方法是：100% 减去组件故障率的乘积。例如，如果系统使用了两个独立的组件，每个组件都具有 99.9% 的可用性，得到的系统可用性为 99.9999%：

𝐴𝑣𝑎𝑖𝑙𝑤𝑜𝑟𝑘𝑙𝑜𝑎𝑑=𝐴𝑣𝑎𝑖𝑙𝑀𝐴𝑋−((100%−𝐴𝑣𝑎𝑖𝑙𝑑𝑒𝑝𝑒𝑛𝑑𝑒𝑛𝑐𝑦)×(100%−𝐴𝑣𝑎𝑖𝑙𝑑𝑒𝑝𝑒𝑛𝑑𝑒𝑛𝑐𝑦)) 100%−(0.1%×0.1%)=99.9999%

但是，如果我不知道依赖项的可用性，该怎么办？

**计算依赖项的可用性。**
有些依赖项会提供有关其可用性的指导，但在没有相关指导的情况下（例如，制造商未发布可用性信息的组件），一个估算方式是确定平均故障间隔时间 (MTBF) 和平均修复时间 (MTTR)。可以通过以下公式来确定可用性估算值：

![](http://latex.codecogs.com/gif.latex?\{Avail}_{EST}=\frac{MTBF}{MTBF+MTTR})

例如，如果 MTBF 为 150 天，且 MTTR 为 1 小时，则可用性估算值是 99.97%。

**可用性成本。**
设计应用程序以实现更高级别的可用性通常导致成本的增加，因此在开始应用程序设计之前，应该确定真正的可用性需求。高级别的可用性对彻底失败场景下的测试和验证提出了更严格的要求。它们要求从各种故障中自动恢复，并要求系统运营的所有方面都按照相同的标准进行类似的构建和测试。例如，容量的添加或删除、更新软件或配置更改的部署或回滚，或者系统数据的迁移都必须依照预期的可用性目标来进行。可用性级别非常高时，软件部署的成本会增加，相应地，创新会受到影响，因为在部署系统时需要放慢行动速度。因此，这里的指导方针是，在系统运营的整个生命周期内，在应用标准和考虑适当的可用性目标时，要做得彻底。

在具有更高可用性设计目标的系统中，成本增加的另一种方式与依赖项的选择有关。在目标较高的情况下，可以选择作为依赖项的软件或服务集减少，具体取决于其中哪些服务已具备我们前面所说的深度投资。随着可用性设计目标的增加，通常要少找一些多用途服务（例如关系数据库），多找一些专用服务。这是因为后者更易于评估、测试和自动化，与包括在内但未使用的功能发生意外交互的可能性也较低。

**恢复时间目标 (RTO) 和恢复点目标 (RPO)**

此类术语最常与灾难恢复 (DR) 相关联，指的是在灾难中恢复工作负载的一系列目标与策略。

**恢复时间目标 (RTO)** 指的是在对组织的任务或任务/业务流程造成负面影响前，工作负载的组件可处于恢复阶段且不可用的总体时长。

**恢复点目标 (RPO)** 是指在对组织的任务或任务/业务流程造成负面影响前，工作负载的数据可为不可用的总体时长。

在可用性取决于工作负载数据的绝大多数情况下，RPO 必须小于 RTO。

RTO 和 MTTR（平均恢复时间）相似，两者都测量中断开始到工作负载恢复之间的时间。但 MTTR 取的是一段时间内多次影响可用性的事件的平均值，而 RTO 则是单次可用性影响事件允许的目标或最大值。
